<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Technology Configuration" href="technology.html" /><link rel="prev" title="Working with S-Parameters" href="sparameters.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2025.07.19 -->
        <title>Multi-Modal Simulations - gds_fdtd 0.4.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=25af2a20" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  --color-brand-primary: #3498db;
  --color-brand-content: #2ecc71;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  --color-brand-primary: #9b59b6;
  --color-brand-content: #e74c3c;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  --color-brand-primary: #9b59b6;
  --color-brand-content: #e74c3c;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">gds_fdtd 0.4.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <span class="sidebar-brand-text">gds_fdtd 0.4.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="solvers.html">FDTD Solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulations.html">Setting Up Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="sparameters.html">Working with S-Parameters</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Multi-Modal Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="technology.html">Technology Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="modules.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/gds_fdtd.core.html">gds_fdtd.core</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/gds_fdtd.lyprocessor.html">gds_fdtd.lyprocessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/gds_fdtd.simprocessor.html">gds_fdtd.simprocessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/gds_fdtd.solver.html">gds_fdtd.solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/gds_fdtd.sparams.html">gds_fdtd.sparams</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/gds_fdtd.logging_config.html">gds_fdtd.logging_config</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/multimodal.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="multi-modal-simulations">
<h1>Multi-Modal Simulations<a class="headerlink" href="#multi-modal-simulations" title="Link to this heading">¶</a></h1>
<p>Multi-modal simulations enable analysis of devices that support multiple electromagnetic modes, such as TE (Transverse Electric) and TM (Transverse Magnetic) polarizations. This capability is essential for understanding polarization effects, mode conversion, and designing polarization-insensitive devices.</p>
<section id="understanding-multi-modal-physics">
<h2>Understanding Multi-Modal Physics<a class="headerlink" href="#understanding-multi-modal-physics" title="Link to this heading">¶</a></h2>
<section id="optical-modes">
<h3>Optical Modes<a class="headerlink" href="#optical-modes" title="Link to this heading">¶</a></h3>
<p>In photonic waveguides, electromagnetic energy propagates in discrete modes:</p>
<ul class="simple">
<li><p><strong>TE Modes (Mode 1)</strong>: Electric field primarily transverse to propagation direction</p></li>
<li><p><strong>TM Modes (Mode 2)</strong>: Magnetic field primarily transverse to propagation direction</p></li>
<li><p><strong>Higher-order modes</strong>: Additional spatial field distributions</p></li>
</ul>
<p>Mode Properties:
- Each mode has a different effective index
- Modes can couple and convert between each other
- Device geometry affects mode confinement and coupling</p>
</section>
<section id="multi-modal-effects">
<h3>Multi-Modal Effects<a class="headerlink" href="#multi-modal-effects" title="Link to this heading">¶</a></h3>
<p>Important phenomena in multi-modal devices:</p>
<ul class="simple">
<li><p><strong>Mode Conversion</strong>: TE↔TM conversion due to asymmetry or birefringence</p></li>
<li><p><strong>Polarization Rotation</strong>: Rotation of linear polarization states</p></li>
<li><p><strong>Differential Phase Shift</strong>: Different phase velocities for TE and TM modes</p></li>
<li><p><strong>Polarization Dependent Loss (PDL)</strong>: Different losses for TE and TM modes</p></li>
</ul>
</section>
</section>
<section id="enabling-multi-modal-simulation">
<h2>Enabling Multi-Modal Simulation<a class="headerlink" href="#enabling-multi-modal-simulation" title="Link to this heading">¶</a></h2>
<section id="basic-multi-modal-setup">
<h3>Basic Multi-Modal Setup<a class="headerlink" href="#basic-multi-modal-setup" title="Link to this heading">¶</a></h3>
<p>Enable multi-modal simulation by specifying multiple modes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">gds_fdtd.solver_tidy3d</span><span class="w"> </span><span class="kn">import</span> <span class="n">fdtd_solver_tidy3d</span>

<span class="c1"># Multi-modal solver setup</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">fdtd_solver_tidy3d</span><span class="p">(</span>
    <span class="n">component</span><span class="o">=</span><span class="n">component</span><span class="p">,</span>
    <span class="n">tech</span><span class="o">=</span><span class="n">technology</span><span class="p">,</span>
    <span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>  <span class="c1"># TE (mode 1) and TM (mode 2)</span>
    <span class="n">wavelength_start</span><span class="o">=</span><span class="mf">1.50</span><span class="p">,</span>
    <span class="n">wavelength_end</span><span class="o">=</span><span class="mf">1.60</span><span class="p">,</span>
    <span class="n">wavelength_points</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span>
    <span class="c1"># ... other parameters</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="mode-configuration-options">
<h3>Mode Configuration Options<a class="headerlink" href="#mode-configuration-options" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Single mode (fundamental TE)</span>
<span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Dual polarization (TE and TM)</span>
<span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

<span class="c1"># Higher-order modes</span>
<span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>  <span class="c1"># Fundamental + higher-order modes</span>
</pre></div>
</div>
<p>The solver automatically:
- Calculates all mode combinations for S-parameters
- Sets up appropriate mode sources and monitors
- Handles mode normalization and coupling analysis</p>
</section>
</section>
<section id="tidy3d-multi-modal-implementation">
<h2>Tidy3D Multi-Modal Implementation<a class="headerlink" href="#tidy3d-multi-modal-implementation" title="Link to this heading">¶</a></h2>
<section id="componentmodeler-integration">
<h3>ComponentModeler Integration<a class="headerlink" href="#componentmodeler-integration" title="Link to this heading">¶</a></h3>
<p>The Tidy3D solver uses the official ComponentModeler plugin for accurate multi-modal S-matrix calculation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tidy3D automatically handles:</span>
<span class="c1"># - Mode solver setup for each port</span>
<span class="c1"># - Source excitation for each mode</span>
<span class="c1"># - Monitor placement and mode decomposition</span>
<span class="c1"># - S-parameter normalization</span>

<span class="n">solver</span> <span class="o">=</span> <span class="n">fdtd_solver_tidy3d</span><span class="p">(</span>
    <span class="n">component</span><span class="o">=</span><span class="n">component</span><span class="p">,</span>
    <span class="n">tech</span><span class="o">=</span><span class="n">technology</span><span class="p">,</span>
    <span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>  <span class="c1"># ComponentModeler handles both modes automatically</span>
    <span class="c1"># ... parameters</span>
<span class="p">)</span>

<span class="n">solver</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>  <span class="c1"># Full multi-modal S-matrix calculation</span>
</pre></div>
</div>
</section>
<section id="port-mode-configuration">
<h3>Port Mode Configuration<a class="headerlink" href="#port-mode-configuration" title="Link to this heading">¶</a></h3>
<p>Each port is configured for multi-modal operation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Inspect multi-modal port setup</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Solver modes: </span><span class="si">{</span><span class="n">solver</span><span class="o">.</span><span class="n">modes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total port-mode combinations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">smatrix_ports</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">solver</span><span class="o">.</span><span class="n">smatrix_ports</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Port </span><span class="si">{</span><span class="n">port</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">port</span><span class="o">.</span><span class="n">mode_spec</span><span class="o">.</span><span class="n">num_modes</span><span class="si">}</span><span class="s2"> modes configured&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="multi-modal-s-parameter-analysis">
<h2>Multi-Modal S-Parameter Analysis<a class="headerlink" href="#multi-modal-s-parameter-analysis" title="Link to this heading">¶</a></h2>
<section id="accessing-multi-modal-s-parameters">
<h3>Accessing Multi-Modal S-Parameters<a class="headerlink" href="#accessing-multi-modal-s-parameters" title="Link to this heading">¶</a></h3>
<p>After simulation, access all mode combinations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run multi-modal simulation</span>
<span class="n">solver</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="c1"># Access different mode combinations</span>
<span class="n">wavelengths</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">wavelength</span>

<span class="c1"># Direct transmission (no mode conversion)</span>
<span class="n">s21_te_te</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># TE→TE</span>
<span class="n">s21_tm_tm</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># TM→TM</span>

<span class="c1"># Cross-modal transmission (mode conversion)</span>
<span class="n">s21_te_tm</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># TE→TM</span>
<span class="n">s21_tm_te</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># TM→TE</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available S-parameter combinations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="multi-modal-visualization">
<h3>Multi-Modal Visualization<a class="headerlink" href="#multi-modal-visualization" title="Link to this heading">¶</a></h3>
<p>Create multi-modal plots:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_multimodal_transmission</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">in_port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot all modal transmission combinations.&quot;&quot;&quot;</span>
    <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">wavelength</span>

    <span class="c1"># Get all mode combinations</span>
    <span class="n">s_te_te</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in_port</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">out_port</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s_tm_tm</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in_port</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">out_port</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">s_te_tm</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in_port</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">out_port</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">s_tm_te</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in_port</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">out_port</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Create multi-panel plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">),</span> <span class="p">(</span><span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># Direct transmission (no conversion)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">s_te_te</span><span class="o">.</span><span class="n">s_mag</span><span class="p">]),</span>
            <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;TE→TE&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">s_tm_tm</span><span class="o">.</span><span class="n">s_mag</span><span class="p">]),</span>
            <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;TM→TM&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Direct Transmission (No Conversion)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Transmission (dB)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Mode conversion</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">s_te_tm</span><span class="o">.</span><span class="n">s_mag</span><span class="p">]),</span>
            <span class="s1">&#39;g--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;TE→TM&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">s_tm_te</span><span class="o">.</span><span class="n">s_mag</span><span class="p">]),</span>
            <span class="s1">&#39;m--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;TM→TE&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Mode Conversion&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Transmission (dB)&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Phase comparison</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">s_te_te</span><span class="o">.</span><span class="n">s_phase</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;TE→TE&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">s_tm_tm</span><span class="o">.</span><span class="n">s_phase</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;TM→TM&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Phase Response&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (μm)&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase (rad)&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Polarization extinction ratio</span>
    <span class="n">ter_te</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span>
              <span class="nb">zip</span><span class="p">(</span><span class="n">s_te_te</span><span class="o">.</span><span class="n">s_mag</span><span class="p">,</span> <span class="n">s_te_tm</span><span class="o">.</span><span class="n">s_mag</span><span class="p">)]</span>
    <span class="n">ter_tm</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span>
              <span class="nb">zip</span><span class="p">(</span><span class="n">s_tm_tm</span><span class="o">.</span><span class="n">s_mag</span><span class="p">,</span> <span class="n">s_tm_te</span><span class="o">.</span><span class="n">s_mag</span><span class="p">)]</span>

    <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">ter_te</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;TE Extinction Ratio&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">ter_tm</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;TM Extinction Ratio&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Polarization Extinction Ratio&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (μm)&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Extinction Ratio (dB)&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Create multi-modal plot</span>
<span class="n">plot_multimodal_transmission</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">in_port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="multi-modal-performance-metrics">
<h2>Multi-Modal Performance Metrics<a class="headerlink" href="#multi-modal-performance-metrics" title="Link to this heading">¶</a></h2>
<section id="polarization-dependent-loss-pdl">
<h3>Polarization Dependent Loss (PDL)<a class="headerlink" href="#polarization-dependent-loss-pdl" title="Link to this heading">¶</a></h3>
<p>Calculate PDL for device characterization:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">calculate_pdl</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">in_port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate Polarization Dependent Loss.&quot;&quot;&quot;</span>
    <span class="c1"># Get TE and TM transmission</span>
    <span class="n">s_te</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in_port</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">out_port</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s_tm</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in_port</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">out_port</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Calculate power transmission</span>
    <span class="n">power_te</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">s_te</span><span class="o">.</span><span class="n">s_mag</span><span class="p">]</span>
    <span class="n">power_tm</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">s_tm</span><span class="o">.</span><span class="n">s_mag</span><span class="p">]</span>

    <span class="c1"># PDL = |10*log10(P_TE/P_TM)|</span>
    <span class="n">pdl</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pte</span><span class="o">/</span><span class="n">ptm</span><span class="p">))</span> <span class="k">for</span> <span class="n">pte</span><span class="p">,</span> <span class="n">ptm</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">power_te</span><span class="p">,</span> <span class="n">power_tm</span><span class="p">)]</span>

    <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">wavelength</span>
    <span class="n">max_pdl</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pdl</span><span class="p">)</span>
    <span class="n">avg_pdl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pdl</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Polarization Dependent Loss Analysis:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Maximum PDL: </span><span class="si">{</span><span class="n">max_pdl</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> dB&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average PDL: </span><span class="si">{</span><span class="n">avg_pdl</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> dB&quot;</span><span class="p">)</span>

    <span class="c1"># Plot PDL vs wavelength</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">pdl</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (μm)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PDL (dB)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Polarization Dependent Loss&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">pdl</span>

<span class="c1"># Calculate PDL</span>
<span class="n">pdl_values</span> <span class="o">=</span> <span class="n">calculate_pdl</span><span class="p">(</span><span class="n">solver</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="mode-conversion-efficiency">
<h3>Mode Conversion Efficiency<a class="headerlink" href="#mode-conversion-efficiency" title="Link to this heading">¶</a></h3>
<p>Analyze mode conversion characteristics:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">analyze_mode_conversion</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">in_port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze mode conversion efficiency.&quot;&quot;&quot;</span>
    <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">wavelength</span>

    <span class="c1"># Get all mode combinations</span>
    <span class="n">s_te_te</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in_port</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">out_port</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s_te_tm</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in_port</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">out_port</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">s_tm_te</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in_port</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">out_port</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s_tm_tm</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in_port</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">out_port</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Calculate conversion efficiencies</span>
    <span class="c1"># For TE input</span>
    <span class="n">te_direct</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">s_te_te</span><span class="o">.</span><span class="n">s_mag</span><span class="p">]</span>  <span class="c1"># TE→TE (direct)</span>
    <span class="n">te_conversion</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">s_te_tm</span><span class="o">.</span><span class="n">s_mag</span><span class="p">]</span>  <span class="c1"># TE→TM (conversion)</span>
    <span class="n">te_conversion_eff</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">te_direct</span><span class="p">,</span> <span class="n">te_conversion</span><span class="p">)]</span>

    <span class="c1"># For TM input</span>
    <span class="n">tm_direct</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">s_tm_tm</span><span class="o">.</span><span class="n">s_mag</span><span class="p">]</span>  <span class="c1"># TM→TM (direct)</span>
    <span class="n">tm_conversion</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">s_tm_te</span><span class="o">.</span><span class="n">s_mag</span><span class="p">]</span>  <span class="c1"># TM→TE (conversion)</span>
    <span class="n">tm_conversion_eff</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tm_direct</span><span class="p">,</span> <span class="n">tm_conversion</span><span class="p">)]</span>

    <span class="c1"># Find peak conversion</span>
    <span class="n">max_te_conv</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">te_conversion_eff</span><span class="p">)</span>
    <span class="n">max_tm_conv</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">tm_conversion_eff</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mode Conversion Analysis:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Max TE→TM conversion: </span><span class="si">{</span><span class="n">max_te_conv</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Max TM→TE conversion: </span><span class="si">{</span><span class="n">max_tm_conv</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Plot conversion efficiency</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="p">[</span><span class="n">eff</span><span class="o">*</span><span class="mi">100</span> <span class="k">for</span> <span class="n">eff</span> <span class="ow">in</span> <span class="n">te_conversion_eff</span><span class="p">],</span>
            <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;TE→TM Conversion&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="p">[</span><span class="n">eff</span><span class="o">*</span><span class="mi">100</span> <span class="k">for</span> <span class="n">eff</span> <span class="ow">in</span> <span class="n">tm_conversion_eff</span><span class="p">],</span>
            <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;TM→TE Conversion&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (μm)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Conversion Efficiency (%)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mode Conversion Efficiency&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">te_conversion_eff</span><span class="p">,</span> <span class="n">tm_conversion_eff</span>

<span class="c1"># Analyze mode conversion</span>
<span class="n">te_conv</span><span class="p">,</span> <span class="n">tm_conv</span> <span class="o">=</span> <span class="n">analyze_mode_conversion</span><span class="p">(</span><span class="n">solver</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="birefringence-analysis">
<h3>Birefringence Analysis<a class="headerlink" href="#birefringence-analysis" title="Link to this heading">¶</a></h3>
<p>Calculate effective index difference between modes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">calculate_birefringence</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">in_port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">device_length</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate device birefringence from phase difference.&quot;&quot;&quot;</span>
    <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">wavelength</span>

    <span class="c1"># Get phase for TE and TM modes</span>
    <span class="n">s_te</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in_port</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">out_port</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s_tm</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in_port</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">out_port</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Unwrap phases for continuous analysis</span>
    <span class="n">phase_te</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">s_te</span><span class="o">.</span><span class="n">s_phase</span><span class="p">)</span>
    <span class="n">phase_tm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">s_tm</span><span class="o">.</span><span class="n">s_phase</span><span class="p">)</span>
    <span class="n">phase_diff</span> <span class="o">=</span> <span class="n">phase_te</span> <span class="o">-</span> <span class="n">phase_tm</span>

    <span class="k">if</span> <span class="n">device_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Calculate effective index difference</span>
        <span class="c1"># Δn_eff = (φ_TE - φ_TM) * λ / (2π * L)</span>
        <span class="n">delta_n_eff</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span> <span class="o">*</span> <span class="n">wl</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">device_length</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">pd</span><span class="p">,</span> <span class="n">wl</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">phase_diff</span><span class="p">,</span> <span class="n">wavelengths</span><span class="p">)]</span>

        <span class="n">avg_birefringence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">delta_n_eff</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Device Birefringence Analysis:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Device length: </span><span class="si">{</span><span class="n">device_length</span><span class="si">}</span><span class="s2"> μm&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average Δn_eff: </span><span class="si">{</span><span class="n">avg_birefringence</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Plot birefringence vs wavelength</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">delta_n_eff</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (μm)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Effective Index Difference&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Device Birefringence&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">delta_n_eff</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Just show phase difference</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">phase_diff</span><span class="p">,</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (μm)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Phase Difference (rad)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;TE-TM Phase Difference&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">phase_diff</span>

<span class="c1"># Calculate birefringence (specify device length if known)</span>
<span class="n">device_length</span> <span class="o">=</span> <span class="mf">10.0</span>  <span class="c1"># μm - replace with actual device length</span>
<span class="n">birefringence</span> <span class="o">=</span> <span class="n">calculate_birefringence</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">device_length</span><span class="o">=</span><span class="n">device_length</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="device-specific-multi-modal-analysis">
<h2>Device-Specific Multi-Modal Analysis<a class="headerlink" href="#device-specific-multi-modal-analysis" title="Link to this heading">¶</a></h2>
<section id="polarization-beam-splitter-pbs">
<h3>Polarization Beam Splitter (PBS)<a class="headerlink" href="#polarization-beam-splitter-pbs" title="Link to this heading">¶</a></h3>
<p>Analyze PBS performance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">analyze_pbs</span><span class="p">(</span><span class="n">solver</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze Polarization Beam Splitter performance.&quot;&quot;&quot;</span>
    <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">wavelength</span>

    <span class="c1"># Assume input port 1, TE output port 2, TM output port 3</span>
    <span class="n">s_te_output</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># TE→TE</span>
    <span class="n">s_tm_output</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># TM→TM</span>

    <span class="c1"># Cross-talk</span>
    <span class="n">s_te_crosstalk</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># TE→TM port</span>
    <span class="n">s_tm_crosstalk</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># TM→TE port</span>

    <span class="c1"># Calculate extinction ratios</span>
    <span class="n">te_extinction</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">sig</span><span class="p">,</span> <span class="n">xt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">s_te_output</span><span class="o">.</span><span class="n">s_mag</span><span class="p">,</span> <span class="n">s_te_crosstalk</span><span class="o">.</span><span class="n">s_mag</span><span class="p">)]</span>
    <span class="n">tm_extinction</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">sig</span><span class="p">,</span> <span class="n">xt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">s_tm_output</span><span class="o">.</span><span class="n">s_mag</span><span class="p">,</span> <span class="n">s_tm_crosstalk</span><span class="o">.</span><span class="n">s_mag</span><span class="p">)]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PBS Performance Analysis:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  TE extinction ratio: </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">te_extinction</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">te_extinction</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> dB&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  TM extinction ratio: </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">tm_extinction</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">tm_extinction</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> dB&quot;</span><span class="p">)</span>

    <span class="c1"># Plot PBS performance</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># Transmission</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">s_te_output</span><span class="o">.</span><span class="n">s_mag</span><span class="p">]),</span>
            <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;TE Transmission&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">s_tm_output</span><span class="o">.</span><span class="n">s_mag</span><span class="p">]),</span>
            <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;TM Transmission&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Transmission (dB)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PBS Transmission&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Extinction ratio</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">te_extinction</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;TE Extinction&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">tm_extinction</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;TM Extinction&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (μm)&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Extinction Ratio (dB)&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PBS Extinction Ratio&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="polarization-rotator">
<h3>Polarization Rotator<a class="headerlink" href="#polarization-rotator" title="Link to this heading">¶</a></h3>
<p>Analyze polarization rotation devices:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">analyze_polarization_rotator</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">in_port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze polarization rotator performance.&quot;&quot;&quot;</span>
    <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">wavelength</span>

    <span class="c1"># Get all mode combinations</span>
    <span class="n">s_te_te</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in_port</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">out_port</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s_te_tm</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in_port</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">out_port</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">s_tm_te</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in_port</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">out_port</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s_tm_tm</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">sparameters</span><span class="o">.</span><span class="n">S</span><span class="p">(</span><span class="n">in_port</span><span class="o">=</span><span class="n">in_port</span><span class="p">,</span> <span class="n">out_port</span><span class="o">=</span><span class="n">out_port</span><span class="p">,</span> <span class="n">in_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">out_modeid</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Calculate rotation angle</span>
    <span class="c1"># For a perfect rotator: cos²(θ) and sin²(θ) for converted/direct components</span>
    <span class="n">rotation_angles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)):</span>
        <span class="c1"># For TE input</span>
        <span class="n">te_direct</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s_te_te</span><span class="o">.</span><span class="n">s_mag</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">te_converted</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s_te_tm</span><span class="o">.</span><span class="n">s_mag</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">total_power</span> <span class="o">=</span> <span class="n">te_direct</span> <span class="o">+</span> <span class="n">te_converted</span>

        <span class="k">if</span> <span class="n">total_power</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cos_theta_sq</span> <span class="o">=</span> <span class="n">te_direct</span> <span class="o">/</span> <span class="n">total_power</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cos_theta_sq</span><span class="p">))</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">rotation_angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rotation_angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">avg_rotation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rotation_angles</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Polarization Rotator Analysis:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average rotation angle: </span><span class="si">{</span><span class="n">avg_rotation</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">°&quot;</span><span class="p">)</span>

    <span class="c1"># Plot rotation angle vs wavelength</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">rotation_angles</span><span class="p">,</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (μm)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Rotation Angle (degrees)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Polarization Rotation Angle&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">rotation_angles</span>
</pre></div>
</div>
</section>
</section>
<section id="best-practices-for-multi-modal-simulations">
<h2>Best Practices for Multi-Modal Simulations<a class="headerlink" href="#best-practices-for-multi-modal-simulations" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p><strong>Mode Selection</strong>
- Include all relevant modes for your device
- Higher-order modes may be needed for multimode devices
- Consider computational cost vs. accuracy trade-offs</p></li>
<li><p><strong>Simulation Parameters</strong>
- Use adequate mesh resolution for mode confinement
- Ensure simulation domain captures mode tails
- Consider run time for mode beating phenomena</p></li>
<li><p><strong>Analysis Considerations</strong>
- Always check energy conservation across modes
- Verify reciprocity for passive devices
- Use appropriate normalization for mode coupling</p></li>
<li><p><strong>Validation</strong>
- Compare with analytical models when available
- Cross-check with experimental data
- Verify mesh convergence for mode calculations</p></li>
</ol>
<p>Multi-modal simulations help you understand polarization effects and mode coupling in photonic devices. This is useful for designing devices where polarization control matters.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="technology.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Technology Configuration</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="sparameters.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Working with S-Parameters</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Multi-Modal Simulations</a><ul>
<li><a class="reference internal" href="#understanding-multi-modal-physics">Understanding Multi-Modal Physics</a><ul>
<li><a class="reference internal" href="#optical-modes">Optical Modes</a></li>
<li><a class="reference internal" href="#multi-modal-effects">Multi-Modal Effects</a></li>
</ul>
</li>
<li><a class="reference internal" href="#enabling-multi-modal-simulation">Enabling Multi-Modal Simulation</a><ul>
<li><a class="reference internal" href="#basic-multi-modal-setup">Basic Multi-Modal Setup</a></li>
<li><a class="reference internal" href="#mode-configuration-options">Mode Configuration Options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tidy3d-multi-modal-implementation">Tidy3D Multi-Modal Implementation</a><ul>
<li><a class="reference internal" href="#componentmodeler-integration">ComponentModeler Integration</a></li>
<li><a class="reference internal" href="#port-mode-configuration">Port Mode Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multi-modal-s-parameter-analysis">Multi-Modal S-Parameter Analysis</a><ul>
<li><a class="reference internal" href="#accessing-multi-modal-s-parameters">Accessing Multi-Modal S-Parameters</a></li>
<li><a class="reference internal" href="#multi-modal-visualization">Multi-Modal Visualization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multi-modal-performance-metrics">Multi-Modal Performance Metrics</a><ul>
<li><a class="reference internal" href="#polarization-dependent-loss-pdl">Polarization Dependent Loss (PDL)</a></li>
<li><a class="reference internal" href="#mode-conversion-efficiency">Mode Conversion Efficiency</a></li>
<li><a class="reference internal" href="#birefringence-analysis">Birefringence Analysis</a></li>
</ul>
</li>
<li><a class="reference internal" href="#device-specific-multi-modal-analysis">Device-Specific Multi-Modal Analysis</a><ul>
<li><a class="reference internal" href="#polarization-beam-splitter-pbs">Polarization Beam Splitter (PBS)</a></li>
<li><a class="reference internal" href="#polarization-rotator">Polarization Rotator</a></li>
</ul>
</li>
<li><a class="reference internal" href="#best-practices-for-multi-modal-simulations">Best Practices for Multi-Modal Simulations</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=6c02275b"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="_static/toggleprompt.js?v=5801b3bb"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    </body>
</html>